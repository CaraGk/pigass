{% extends 'PigassCoreBundle::layout.html.twig' %}

{% block title %}{{ parent() }} - Adhérents{% endblock %}

{% block headline %}Adhérents actuels{% endblock %}

{% block action %}
    <li class="field"><a href="{{ path('user_register_export') }}"><button type="button">Exporter (xls)</button></a></li>
{% endblock %}

{% block content %}
    <ul class="filters">
        <li>
            <div class="title">Validation</div>
            {% if filters['valid'] is not null %}
                <div class="item set"><a href="{{ path('user_register_filter_remove', {'type': 'valid', 'id': 0}) }}" title="Supprimer le filtre par adhésion">{{ filters['valid'] }}</a></div>
            {% else %}
                <div class="item"><a href="{{ path('user_register_filter_add', {'type': 'valid', 'id': 0, 'value': 1}) }}" title="Filtrer par adhésion validée">Oui</a></div>
                <div class="item"><a href="{{ path('user_register_filter_add', {'type': 'valid', 'id': 0, 'value': 0}) }}" title="Filtrer par adhésion non validée">Non</a></div>
            {% endif %}
        </li>
        {% for question in questions %}
            <li>
                <div class="title">{{ question.name }}</div>
                {% if filters['questions'][question.id] is defined %}
                    <div class="item"><a href="{{ path('user_register_filter_remove', {'type': 'questions', 'id': question.id}) }}" title="Suprimer le filtre {{ question.name }} : {{ filters['questions'][question.id] }}">{{ filters['questions'][question.id] }}</a></div>
                {% else %}
                    {% for answer in question.more %}
                        <div class="item"><a href="{{ path('user_register_filter_remove', {'type': 'questions', 'id': question.id, 'value': answer}) }}" title="Filtrer par {{ question.name }} : {{ answer }}">{{ answer }}</a></div>
                    {% endfor %}
                {% endif %}
            </li>
        {% endfor %}
    </ul>
    <ul>
    {% for membership in memberships %}
        <li class="entity person">
            <div class="field">{{ membership.person }}</div>
            {% if membership.payedOn is not null %}
                <div class="field">Paiement par {{ membership.readableMethod|lower }} effectué ({{ membership.payedOn|date('d/m/Y') }})</div>
            {% else %}
                <div class="field">
                    <a href="{{ path('user_register_validate', {'id': membership.id, 'userid': membership.person.user.id, view: 'index'}) }}" title="Valider la réception du paiement pour cette adhésion">Valider</a>
                    <a href="{{ path('user_register_delete', {'id': membership.id, 'userid': membership.person.user.id, 'view': 'index'}) }}" title="Supprimer cette adhésion">Supprimer</a>
                </div>
            {% endif %}
            <div class="field"><a href="{{ path('user_register_index', {'userid': membership.person.user.id}) }}" title="Afficher le détail des adhésions de l'étudiant">Détail</a></div>
        </li>
    {% else %}
        <li>Aucune adhésion enregistrée.</li>
    {% endfor %}
    </ul>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/pigassregister/js/filter.js') }}" type="text/javascript"></script>
{% endblock %}
