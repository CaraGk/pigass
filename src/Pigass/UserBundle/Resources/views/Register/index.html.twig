{% extends 'PigassCoreBundle::layout.html.twig' %}

{% block title %}{{ parent() }} - Adhérents{% endblock %}

{% block headline %}Adhérents actuels{% endblock %}

{% block action %}
    <li class="btn btn-primary">
        <a href="{{ path('user_register_export', {'slug': slug}) }}">
            {{ icon('folder-open') }} Exporter (xls)
        </a>
    </li>
    {% if filters['valid'] is null %}
        <li class="btn btn-default">
            <a href="{{ path('user_register_filter_add', {'type': 'valid', 'id': 0, 'value': 1, 'slug': slug}) }}" title="Filtrer par adhésion validée">
                Validation ?
            </a>
        </li>
    {% elseif filters['valid'] == true %}
        <li class="btn btn-success">
            <a href="{{ path('user_register_filter_add', {'type': 'valid', 'id': 0, 'value': 0, 'slug': slug}) }}" title="Filtrer par adhésion non validée">
                Validation : Oui
            </a>
        </li>
    {% elseif filters['valid'] == false %}
        <li class="btn btn-danger">
            <a href="{{ path('user_register_filter_remove', {'type': 'valid', 'id': 0, 'slug': slug}) }}" title="Supprimer le filtre par adhésion">
                Validation : Non
            </a>
        </li>
    {% endif %}
    {% for question in questions %}
        <li class="btn btn-sm btn-default">
            <div class="title">{{ question.name }}</div>
            {% if filters['questions'][question.id] is defined %}
                <div class="item"><a href="{{ path('user_register_filter_remove', {'type': 'questions', 'id': question.id, 'slug': slug}) }}" title="Suprimer le filtre {{ question.name }} : {{ filters['questions'][question.id] }}">{{ filters['questions'][question.id] }}</a></div>
            {% else %}
                {% for answer in question.more %}
                    <div class="item"><a href="{{ path('user_register_filter_add', {'type': 'questions', 'id': question.id, 'value': answer, 'slug': slug}) }}" title="Filtrer par {{ question.name }} : {{ answer }}">{{ answer }}</a></div>
                {% endfor %}
            {% endif %}
        </li>
    {% endfor %}

{% endblock %}

{% block content %}
    <ul class="entities list-group">
    {% for membership in memberships %}
        <li class="entity person list-group-item row">
            <span class="btn-group pull-right">
                <button class="btn btn-primary dropdown-toogle" data-toggle="dropdown">Actions <span class="caret"></span></button>
                <ul class="dropdown-menu">
                    {% if membership.status == 'registered' %}
                        <li>
                            <a href="{{ path('user_register_validate', {'id': membership.id, 'userid': membership.person.user.id, view: 'index'}) }}" title="Valider la réception du paiement pour cette adhésion">
                                {{ icon('ok') }} Valider le paiement
                            </a>
                        </li>
                        <li>
                            <a href="{{ path('user_register_delete', {'id': membership.id, 'userid': membership.person.user.id, 'view': 'index'}) }}" title="Supprimer cette adhésion">
                                {{ icon('trash') }} Supprimer
                            </a>
                        </li>
                    {% elseif membership.status == 'paid' %}
                        <li>
                            <a href="{{ path('user_register_validate', {'id': membership.id, 'userid': membership.person.user.id, view: 'index'}) }}" title="Valider la réception de la fiche signée pour cette adhésion">
                                {{ icon('ok') }} Valider la fiche
                            </a>
                        </li>
                    {% endif %}
                    <li>
                        <a href="{{ path('user_register_list', {'userid': membership.person.user.id, 'slug': slug}) }}" title="Afficher les informations personnelles de l'adhérent">
                            {{ icon('user') }} Informations
                        </a>
                    </li>
                </ul>
            </span>

            <div class="field title">{{ membership.person }}</div>
            <div class="field">({{ membership.person.birthday|date('d/m/y') }})</div>
            {% if membership.payedOn is not null %}
                <div class="">Adhésion par {{ membership.method.label|lower }} effectuée le {{ membership.payedOn|date('d/m/Y') }}</div>
            {% endif %}
        </li>
    {% else %}
        <li class="list-group-item">Aucune adhésion enregistrée.</li>
    {% endfor %}
    </ul>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/pigassregister/js/filter.js') }}" type="text/javascript"></script>
{% endblock %}
